<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport"
          content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet"
          integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
    <style>
        .border-bottom {
            border-bottom: 1px solid #dee2e6 !important;
            margin: 0;
        }
    </style>
</head>
<body style="
background: url('https://user.xspin.vn/upload/images/vqmm_logo_sk_23183_1912024114526.png?v=3185398892717') 0% 0% / 100vw 100vh fixed rgb(250, 250, 250);
overflow: hidden;
">
<div class="container">
    <div class="row">
        <div class="col-12 col-md-6 mt-3">

        </div>
        <div class="col-12 col-md-6">
            <div id="vqRight" class="mt-5">
                <div id="canvasCt" style="position: relative; ">
                    <div id="quayBtn" class="noSelectedColor" onclick="startSpin()"
                         style="background-image: url('Images/btn_qu333ay.png'); background-position: center; background-size: cover">
                        <img id="idAnhNutQuay"
                             style="width: 100%; position: absolute; top: -5%; left: 0; max-width: 100px; right: 0; margin: auto;"
                             src="https://admin.xspin.vn/upload/images/vqmm_cauhinhmacdinh_avq_10.png?v=712382351517"/>
                    </div>
                    <canvas id="canvas" width="620" height="620"
                            data-responsiveMinWidth="180"
                            data-responsiveScaleHeight="true"
                            data-responsiveMargin="50"
                            style="background-image: url('https://vqmm.xspin.vn/Images/13459-vien%20trang.png');
                            background-size: contain; background-repeat: no-repeat; background-position: center">
                        <p style="color: white; text-align: center">Rất tiết, trình duyệt của bạn không hỗ trợ canvas.
                            Hãy thử trình duyệt khác ví dụ như Chrome hoặc Firefox.</p>
                    </canvas>
                    <div id="dvNutTrungTam" style="cursor:pointer; position: absolute; top: 39%; left: 38% "></div>
                    <div id="border_outside"
                         style="background-image: url('https://vqmm.xspin.vn/Images/13459-vien%20trang.png'); background-size: contain;"></div>
                </div>
            </div>
        </div>
    </div>
</div>
<div class="modal fade" id="modalDetail">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header" style="background-color: #CF0204; color: white; font-weight: bold">
                Chúc mừng, Bạn đã nhận được 1 luợt quay.
            </div>
            <div class="modal-body">
                <p class="border-bottom">Số điện thoại: <span id="phone_text"></span></p>
                <p class="border-bottom">Họ tên: <span id="full_name_text"></span></p>
                <p class="border-bottom">Facebook: <span id="facebook_text"></span></p>
                <p class="border-bottom">Địa chỉ: <span id="address_text"></span></p>
            </div>
            <div class=" d-flex justify-content-end">
                <button type="button" class="btn btn-danger m-2" onclick="startSpin()">Quay</button>
            </div>
        </div>

    </div>
</div>
<div class="modal fade" id="modalForm" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1"
     aria-labelledby="staticBackdropLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                Mời bạn nhập thông tin
            </div>
            <div class="modal-body">
                <div class="mb-3">
                    <label for="number_phone" class="form-label">Số điện thoại</label>
                    <input type="text" class="form-control" id="number_phone" placeholder="Số điện thoại">
                </div>
                <div class="mb-3">
                    <label for="full_name" class="form-label">Họ và tên</label>
                    <input class="form-control" id="full_name" placeholder="Họ và tên">
                </div>
                <div class="mb-3">
                    <label for="facebook" class="form-label">Đường dẫn facebook cá nhân</label>
                    <input class="form-control" id="facebook" placeholder="https://facebook.com/quangbaond">
                </div>
                <div class="mb-3">
                    <label for="address" class="form-label">Địa chỉ</label>
                    <textarea class="form-control" id="address" rows="3"></textarea>
                </div>
            </div>
            <div class="modal-footer">
                <div class="d-flex justify-content-end w-100">
                    <button type="button" class="btn btn-danger mx-1" data-bs-dismiss="modal">Đóng</button>
                    <button type="button" onclick="showInfo()" class="btn btn-success">Xác nhận</button>
                </div>
            </div>

        </div>
    </div>
</div>


<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.2/dist/umd/popper.min.js"
        integrity="sha384-IQsoLXl5PILFhosVNubq5LC7Qb9DXgDA9i+tQ8Zj3iwWAwPtgFTxbJ8NT4GN1R8p"
        crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.min.js"
        integrity="sha384-cVKIPhGWiC2Al4u+LWgxfKTRIcfu0JTxR+EQDz/bgldoEyl4H0zUF0QKbrJ0EcQF"
        crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

<script src="./js/jquery.min.js"></script>
<script src="./Plugins/Wheel/Winwheel.js"></script>
<script src="./Plugins/TweenMax/TweenMax.js"></script>
<script src="./js/config.js"></script>
<script>
    // window.addEventListener('DOMContentLoaded', function () {
    //     if ((window.outerWidth - window.innerWidth) > 100 || (window.outerHeight - window.innerHeight) > 100) {
    //         $('body').html('<div style="text-align: center; margin-top: 20px;"><h1>Trang web không hỗ trợ DevTools</h1></div>');
    //         $('body').css('background', '#fff')
    //     }
    // });
    window.onload = function () {
        getGiaiThuong()
        // check if open dev tool
        var isDevToolsOpened = false;
        if ((window.outerWidth - window.innerWidth) > 100 || (window.outerHeight - window.innerHeight) > 100) {
            isDevToolsOpened = true;
        }
        window.addEventListener('resize', function () {
            if ((window.outerWidth - window.innerWidth) > 100 || (window.outerHeight - window.innerHeight) > 100) {
                isDevToolsOpened = true;
            } else {
                isDevToolsOpened = false;
            }
        });
        window.addEventListener('DOMContentLoaded', function () {
            if ((window.outerWidth - window.innerWidth) > 100 || (window.outerHeight - window.innerHeight) > 100) {
                isDevToolsOpened = true;
            }
        });
        // setInterval(function () {
        //     if (isDevToolsOpened) {
        //         $(document).ready(function () {
        //             $('body').html('<div style="text-align: center; margin-top: 20px;"><h1>Trang web không hỗ trợ DevTools</h1></div>');
        //             $('body').css('background', '#fff')
        //         });
        //     }
        // }, 1000);

    }
    var isStartSpin = "False";
    var modalForm = new bootstrap.Modal(document.getElementById('modalForm'), {
        keyboard: false
    })
    var modalDetail = new bootstrap.Modal(document.getElementById('modalDetail'), {
        keyboard: false
    })
    var theWheel = null
    var user = null

    function getGiaiThuong() {
        $.ajax({
            url: API_URL + '/prize-wheel',
            type: 'GET',
            dataType: 'json',
            async: false,
            success: function (data) {
                responsiveCanvas()
                createWheel(data.data)
            }
        })
    }

    const responsiveCanvas = function () {
        var canvas = document.getElementById("canvas");
        var parent = document.getElementById("canvasCt");
        var width = parent.offsetWidth;
        var height = parent.offsetHeight;
        canvas.style.width = width + "px";
        canvas.style.height = height + "px";
        canvas.width = width;
        canvas.height = height;
    }
    audio = new Audio('/Mp3s/tick.mp3');  // Create audio object and load desired file.
    audioWinning = new Audio('./Mp3s/fanfare-winner.mp3');
    audioFound = new Audio('./Mp3s/foundMa.mp3');
    audioClick = new Audio('./Mp3s/clickingsound.mp3');
    audioCorrect = new Audio('./Mp3s/correct.mp3');
    audioKhongDung = new Audio('./Mp3s/MaKhongDung.mp3');
    audioGameOver = new Audio('./Mp3s/Game_Over.mp3');

    function alertPrize(indicatedSegment) {
        // alert(indicatedSegment)
        isStartSpin = "False";
        Swal.fire({
            title: 'Chúc mừng bạn đã trúng thưởng',
            text: 'Bạn đã trúng thưởng ' + indicatedSegment.text,
            icon: 'success',
            confirmButtonText: 'OK'

        })

        const swalWithBootstrapButtons = Swal.mixin({
            customClass: {
                confirmButton: "btn btn-success mx-1",
                cancelButton: "btn btn-danger mx-1"
            },
            buttonsStyling: false
        });
        swalWithBootstrapButtons.fire({
            title: 'Chúc mừng bạn đã trúng thưởng',
            text: 'Bạn đã trúng thưởng ' + indicatedSegment.text,
            icon: 'success',
            // showCancelButton: true,
            confirmButtonText: "OK",
            reverseButtons: true
        }).then((result) => {
            if (result.isConfirmed) {
                swalWithBootstrapButtons.fire({
                    title: "Thành công",
                    text: "Bạn có muốn tiếp tục quay không?",
                    icon: "success",
                    showCancelButton: true,
                    confirmButtonText: "Có",
                    cancelButtonText: "Không",
                    reverseButtons: true
                }).then((result) => {
                    if (result.isConfirmed) {
                        swalWithBootstrapButtons.fire({
                            title: "Thông báo",
                            text: "Chúng tôi sẽ liên hệ với bạn để trao giải thưởng",
                            icon: "success"
                        });
                    } else if (
                        /* Read more about handling dismissals below */
                        result.dismiss === Swal.DismissReason.cancel
                    ) {
                        swalWithBootstrapButtons.fire({
                            title: "Thông báo",
                            text: "Chúng tôi sẽ liên hệ với bạn để trao giải thưởng",
                            icon: "success"
                        });
                    }
                });
            }
        });
        audioWinning.play();
        user.prize = indicatedSegment.text
        $.ajax({
            url: API_URL + '/prize-wheel',
            type: 'POST',
            dataType: 'json',
            data: user,
            success: function (data) {
                console.log(data)

            }
        })
    }

    function playSound() {
        audio.pause();
        audio.currentTime = 0;
        audio.play();
    }

    function createWheel(segmentsData = []) {
        $('#dvNutTrungTam').html('<img onclick="turnOnModal()" style="width: 130px;" src="https://admin.xspin.vn/Upload/Images/NutQuay_Final.png" />')

        var widthN = 295;
        var innerWidth1 = 62;
        font_s = 15;
        console.log(window.innerWidth)
        if (window.innerWidth <= 375) {
            $('body').css('background', 'url("https://user.xspin.vn/upload/images/vqmm_tlct_sk_23183_191202416426.jpg?v=3362982737597") 0% 0% / 100vw 100vh fixed rgb(250, 250, 250)')
            $('#idAnhNutQuay').css('top', '15%')
            $('#dvNutTrungTam img').css('width', '100px')
            $('#dvNutTrungTam').css({'top': '50%', 'left': '50%', transform: 'translate(-50%, -50%)'})
            widthN = 170;
            innerWidth1 = 40;
            font_s = 10;
        } else if (window.innerWidth == 390) {
            $('#idAnhNutQuay').css('top', '15%')
            $('body').css('background', 'url("https://user.xspin.vn/upload/images/vqmm_tlct_sk_23183_191202416426.jpg?v=3362982737597") 0% 0% / 100vw 100vh fixed rgb(250, 250, 250)')

            $('#dvNutTrungTam img').css('width', '100px')
            $('#dvNutTrungTam').css({'top': '50%', 'left': '50%', transform: 'translate(-50%, -50%)'})
            widthN = 173;
            innerWidth1 = 40;
            font_s = 10;
        } else if (window.innerWidth < 415 && window.innerWidth > 375) {
            $('#idAnhNutQuay').css('top', '15%')
            $('body').css('background', 'url("https://user.xspin.vn/upload/images/vqmm_tlct_sk_23183_191202416426.jpg?v=3362982737597") 0% 0% / 100vw 100vh fixed rgb(250, 250, 250)')

            $('#dvNutTrungTam img').css('width', '100px')
            $('#dvNutTrungTam').css({'top': '50%', 'left': '50%', transform: 'translate(-50%, -50%)'})
            widthN = 185;
            innerWidth1 = 40;
            font_s = 10;
        } else if (window.innerWidth < 447 && window.innerWidth > 375) {
            $('#idAnhNutQuay').css('top', '15%')
            $('body').css('background', 'url("https://user.xspin.vn/upload/images/vqmm_tlct_sk_23183_191202416426.jpg?v=3362982737597") 0% 0% / 100vw 100vh fixed rgb(250, 250, 250)')

            $('#dvNutTrungTam img').css('width', '100px')
            $('#dvNutTrungTam').css({'top': '50%', 'left': '50%', transform: 'translate(-50%, -50%)'})
            widthN = 200;
            innerWidth1 = 40;
            font_s = 10;
        } else if (window.innerWidth < 576 && window.innerWidth > 375) {
            $('#idAnhNutQuay').css('top', '15%')
            $('body').css('background', 'url("https://user.xspin.vn/upload/images/vqmm_tlct_sk_23183_191202416426.jpg?v=3362982737597") 0% 0% / 100vw 100vh fixed rgb(250, 250, 250)')

            $('#dvNutTrungTam img').css('width', '100px')
            $('#dvNutTrungTam').css({'top': '50%', 'left': '50%', transform: 'translate(-50%, -50%)'})
            widthN = 182;
            innerWidth1 = 40;
            font_s = 10;
        } else if (window.innerWidth < 768 && window.innerWidth > 576) {
            console.log('ok')
            $('body').css('background', 'url("https://user.xspin.vn/upload/images/vqmm_tlct_sk_23183_191202416426.jpg?v=3362982737597") 0% 0% / 100vw 100vh fixed rgb(250, 250, 250)')

            $('#dvNutTrungTam img').css('width', '100px')
            $('#dvNutTrungTam').css({'top': '50%', 'left': '50%', transform: 'translate(-50%, -50%)'})
            widthN = 175;
            innerWidth1 = 40;
            font_s = 10;
        } else if (window.innerWidth < 992 && window.innerWidth > 768) {
            $('body').css('background', 'url("https://user.xspin.vn/upload/images/vqmm_tlct_sk_23183_191202416426.jpg?v=3362982737597") 0% 0% / 100vw 100vh fixed rgb(250, 250, 250)')
            $('#dvNutTrungTam').css({'top': '50%', 'left': '50%', transform: 'translate(-50%, -50%)'})
            widthN = 295;
            innerWidth1 = 50;
            font_s = 15;
        } else if (window.innerWidth < 1200 && window.innerWidth > 992) {
            console.log('ok')
            $('#idAnhNutQuay').css('top', '7%')

            $('#dvNutTrungTam').css({'top': '50%', 'left': '50%', transform: 'translate(-50%, -50%)'})

            widthN = 220;
            innerWidth1 = 10;
            font_s = 13;
        } else if (window.innerWidth < 1200 && window.innerWidth > 992) {
            console.log('ok')
            $('#dvNutTrungTam').css({'top': '50%', 'left': '50%', transform: 'translate(-50%, -50%)'})

            widthN = 295;
            innerWidth1 = 62;
            font_s = 15;
        } else if (window.innerWidth < 1400 && window.innerWidth > 1200) {
            console.log('ok')
            $('#idAnhNutQuay').css('top', '0%')

            $('#dvNutTrungTam').css({'top': '50%', 'left': '50%', transform: 'translate(-50%, -50%)'})

            widthN = 260;
            innerWidth1 = 62;
            font_s = 15;
        } else if (window.innerWidth < 1600 && window.innerWidth > 1400) {
            console.log('ok')
            $('#dvNutTrungTam').css({'top': '50%', 'left': '50%', transform: 'translate(-50%, -50%)'})

            widthN = 295;
            innerWidth1 = 62;
            font_s = 15;
        } else if (window.innerWidth < 1800 && window.innerWidth > 1600) {
            console.log('ok')
            $('#dvNutTrungTam').css({'top': '50%', 'left': '50%', transform: 'translate(-50%, -50%)'})

            widthN = 295;
            innerWidth1 = 62;
            font_s = 15;
        } else if (window.innerWidth < 2000 && window.innerWidth > 1800) {
            console.log('ok')
            $('#dvNutTrungTam').css({'top': '50%', 'left': '50%', transform: 'translate(-50%, -50%)'})

            widthN = 295;
            innerWidth1 = 62;
            font_s = 15;
        } else if (window.innerWidth < 2200 && window.innerWidth > 2000) {
            console.log('ok')
            $('#dvNutTrungTam').css({'top': '50%', 'left': '50%', transform: 'translate(-50%, -50%)'})

            widthN = 295;
            innerWidth1 = 62;
            font_s = 15;
        } else if (window.innerWidth < 2400 && window.innerWidth > 2200) {
            console.log('ok')
            $('#dvNutTrungTam').css({'top': '50%', 'left': '50%', transform: 'translate(-50%, -50%)'})

            widthN = 295;
            innerWidth1 = 62;
            font_s = 15;
        } else if (window.innerWidth < 2600 && window.innerWidth > 2400) {
            console.log
            $('#dvNutTrungTam').css({'top': '50%', 'left': '50%', transform: 'translate(-50%, -50%)'})
        }
        segments = []
        for (var i = 0; i < segmentsData.length; i++) {
            console.log(segmentsData[i].fill_color)
            segments.push({
                'fillStyle': segmentsData[i].fill_color,
                'text': segmentsData[i].name,
                'textFillStyle': segmentsData[i].text_color,
                'textFontSize': font_s,
                'strokeStyle': 'white',
            })
        }
        theWheel = new Winwheel({
            'outerRadius': widthN,        // Set outer radius so wheel fits inside the background.
            'innerRadius': innerWidth1,         // Make wheel hollow so segments don't go all way to center.
            'textFontSize': font_s,         // Set default font size for the segments.
            'textOrientation': 'horizontal', // Make text vertial so goes down from the outside of wheel.
            'textAlignment': 'outer',    // Align text to outside of wheel.
            'numSegments': segments.length,         // Specify number of segments.
            'segments': segments,
            'animation':           // Specify the animation to use.
                {
                    'type': 'spinToStop',
                    'duration': 12,     // Duration in seconds.
                    'spins': 5,     // Default number of complete spins.
                    'callbackSound': playSound,
                    'callbackFinished': alertPrize
                },
            //'drawMode': 'image',
            'lineWidth': 0,
            'responsive': true
        });
    }

    window.addEventListener('resize', function () {
        responsiveCanvas()
        createWheel()
    })

    function turnOnModal() {
        modalForm.show()
    }

    function spin() {
        if (isStartSpin === "True") {
            return;
        }
        isStartSpin = "True";
        console.log(isStartSpin)
        theWheel.animation.spins = 5;
        theWheel.rotationAngle = 0;
        theWheel.draw();
        theWheel.startAnimation();
    }

    function showInfo() {
        const number_phone = $('#number_phone').val()
        const full_name = $('#full_name').val()
        const address = $('#address').val()
        const facebook = $('#facebook').val()
        console.log(number_phone, full_name, address, facebook)
        if (number_phone === '' || full_name === '' || address === '' || facebook === '') {
            Swal.fire({
                title: 'Thông báo',
                text: 'Bạn cần nhập đầy đủ thông tin',
                icon: 'warning',
                confirmButtonText: 'OK'
            })
            return
        } else {
            user = {
                phone: number_phone,
                full_name: full_name,
                address: address,
                facebook: facebook
            }
            $('#phone_text').text(user.phone)
            $('#full_name_text').text(user.full_name)
            $('#address_text').text(user.address)
            $('#facebook_text').text(user.facebook)
            modalForm.hide()
            modalDetail.show()
        }
    }

    function startSpin() {

        $.ajax({
            url: API_URL + '/prize-check-user/' + $('#number_phone').val(),
            type: 'GET',
            dataType: 'json',
            async: false,
            success: function (data) {
                Swal.fire({
                    title: 'Thông báo',
                    text: 'Số điện thoại đã được sử dụng',
                    icon: 'warning',
                    confirmButtonText: 'OK'
                })
            },
            error: function (data) {
                modalForm.hide()
                modalDetail.hide()
                spin()
            }
        })
    }

    function resetWheel() {
        theWheel.stopAnimation(false);  // Stop the animation, false as param so does not call callback function.
        theWheel.rotationAngle = 0;     // Re-set the wheel angle to 0 degrees.
        theWheel.draw();                // Call draw to render changes to the wheel.
        wheelSpinning = false;          // Reset to false to power buttons and spin can be clicked again.
    }

</script>
</body>
</html>